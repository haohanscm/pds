webpackJsonp([20],{"+oC7":function(t,e){},T3yY:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("RHYT"),o=a("DVuL"),l=a("8uth"),c=a.n(l);var i={build:function(t,e){if("[object Array]"!==Object.prototype.toString.call(t))return!1;if("[object Number]"!==Object.prototype.toString.call(e)||0>=e)return!1;var a=[],s=[];t.sort(function(t,e){return e.goodsList.length-t.goodsList.length});for(var o=e;o>0;)a.push([]),o--;t.forEach(function(t){a.sort(function(t,e){return t.length-e.length}),a[0].push({title:!0,neck:!1,name:t.categoryName,body:!1},{title:!1,neck:!0,name:t.categoryName,body:!1}),t.goodsList.forEach(function(e){e.oldPurchasePrice=e.purchasePrice,a[0].push({title:!1,neck:!1,name:t.categoryName,body:e})})});for(var l=function(t){a[t].forEach(function(e,a){s[a]?s[a]=s[a]:s[a]=[],s[a][t]=e})},c=0;c<a.length;c++)l(c);return console.log(s),s.forEach(function(t){for(var a=0;a<e;a++){var s=t[a];s||(s={title:!1,neck:!1,name:!1,body:{}}),t[a]=s}}),s}},n={data:function(){return{activeName:"first",buyerId:"",request:new s.a,buyerList:[],date:"",head:{},shopDia:!1,endDate:"",startDate:"",goodsReqList:[],deliveryTime:(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),pmName:this.$utils.getCookie("pmName"),goodsList:[],loading:!0}},components:{},watch:{},created:function(){this.fetchBuyerList()},methods:{handleCheck:function(){switch(this.activeName){case"first":this.queryList()}},handlePriceChange:function(t){this.goodsReqList.push({id:t.id,price:t.purchasePrice}),this.batchUpdateGoodsPrice(t),console.log(t)},exportExcel:function(){c.a.getExcel("ddd","",this.pmName+"报价单.xls","bb")},handleClick:function(){this.queryList()},goToNext:function(){var t=+new Date(this.endDate);t+=864e5;var e=(t=new Date(t)).getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();this.date=e,this.queryList()},handleDest:function(t,e){var a=this,s=void 0;this.buyerList.forEach(function(t,e){t.id==a.buyerId&&(s=e)}),console.log(e),console.log(this.buyerList[s].buyerName),this.$confirm("您确认将您对"+this.buyerList[s].buyerName+"下"+this.startDate+"日到"+this.endDate+"日的报价上升"+t.rate+"的比率应用到"+t.buyerName+"？").then(function(e){a.copyGoodsByBuyer({destBuyerId:t.id,queryDate:a.deliveryTime,rate:t.rate})})},fetchBuyerList:function(){var t=this;this.request.fetchBuyerList().then(function(e){200==e.code?t.buyerList=e.ext:t.$message.warning(e.msg)}).catch(function(e){t.$message.warning(e)})},queryList:function(){var t=this,e=o.Loading.service();this.request.queryGoodsList({buyerId:this.buyerId,queryDate:this.date}).then(function(a){200===a.code?(t.head=a.ext.pdsBuyer,t.goodsList=i.build(a.ext.categoryList,4),t.startDate=a.ext.startDate,t.endDate=a.ext.endDate,console.log(t.goodsList),t.loading=!1):(t.$message.warning(a.msg),t.loading=!1),e.close()}).catch(function(a){t.$message.warning(a),t.loading=!1,e.close()})},batchUpdateGoodsPrice:function(t){var e=this;this.request.batchUpdateGoodsPrice({goodsReqList:this.goodsReqList,buyerId:this.buyerId}).then(function(a){200===a.code?(e.$message.success(a.msg),t.oldPurchasePrice=t.purchasePrice):(e.$message.warning(a.msg),t.purchasePrice=t.oldPurchasePrice)}).catch(function(a){e.$message.warning(a),t.purchasePrice=t.oldPurchasePrice})},copyGoodsByBuyer:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.buyerId=this.buyerId,this.request.copyGoodsByBuyer(e).then(function(e){200===e.code?t.$message.success(e.msg):t.$message.warning(e.msg)})}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"title"},[a("div",[t._v("选择商家:"),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.buyerId,callback:function(e){t.buyerId=e},expression:"buyerId"}},t._l(t.buyerList,function(t){return a("el-option",{key:t.id,attrs:{filterable:"",label:t.buyerName,value:t.id}})}),1)],1),t._v(" "),a("div",[a("div",[t._v("报价时间:")]),t._v(" "),a("div",[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)]),t._v(" "),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleCheck}},[t._v("查询\n            ")])],1)]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"cont-item"},[a("table",{attrs:{border:"1","v-loading":t.loading}},[a("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName))]),t._v(" "),a("tbody",[a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("采购商名称")]),t._v(" "),a("td",{attrs:{colspan:"4"}},[t._v(t._s(t.head.buyerName))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("负责人")]),t._v(" "),a("td",{staticClass:"print-hidden",attrs:{colspan:"2"}},[t._v(t._s(t.head.contact))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("有效期")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.startDate)+" 至 "+t._s(t.endDate)+" "),a("el-button",{attrs:{type:"text"},on:{click:t.goToNext}},[t._v("下一阶段报价")])],1)]),t._v(" "),a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("地址")]),t._v(" "),a("td",{attrs:{colspan:"7"}},[t._v(t._s(t.head.address))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("联系电话")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.head.telephone))])]),t._v(" "),t._m(0),t._v(" "),t._l(t.goodsList,function(e,s){return a("tr",{key:s},[e[0]&&e[0].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[0].name))]):t._e(),t._v(" "),e[0]&&e[0].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[0]&&e[0].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[0]&&e[0].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[t._v(t._s(e[0].body.goodsName)+"-"+t._s(e[0].body.modelName))]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[t._v(t._s(e[0].body.marketPrice))]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[e[0].body.purchasePrice?a("el-input-number",{on:{change:function(a){return t.handlePriceChange(e[0].body)}},model:{value:e[0].body.purchasePrice,callback:function(a){t.$set(e[0].body,"purchasePrice",a)},expression:"item[0].body.purchasePrice"}}):t._e()],1):t._e(),t._v(" "),e[1]&&e[1].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[1].name))]):t._e(),t._v(" "),e[1]&&e[1].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[1]&&e[1].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[1]&&e[1].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[t._v(t._s(e[1].body.goodsName)+"-"+t._s(e[1].body.modelName))]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[t._v(t._s(e[1].body.marketPrice))]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[e[1].body.purchasePrice?a("el-input-number",{on:{change:function(a){return t.handlePriceChange(e[1].body)}},model:{value:e[1].body.purchasePrice,callback:function(a){t.$set(e[1].body,"purchasePrice",a)},expression:"item[1].body.purchasePrice"}}):t._e()],1):t._e(),t._v(" "),e[2]&&e[2].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[2].name))]):t._e(),t._v(" "),e[2]&&e[2].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[2]&&e[2].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[2]&&e[2].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[t._v(t._s(e[2].body.goodsName)+"-"+t._s(e[2].body.modelName))]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[t._v(t._s(e[2].body.marketPrice))]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[e[2].body.purchasePrice?a("el-input-number",{on:{change:function(a){return t.handlePriceChange(e[2].body)}},model:{value:e[2].body.purchasePrice,callback:function(a){t.$set(e[2].body,"purchasePrice",a)},expression:"item[2].body.purchasePrice"}}):t._e()],1):t._e(),t._v(" "),e[3]&&e[3].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[3].name))]):t._e(),t._v(" "),e[3]&&e[3].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[3]&&e[3].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[3]&&e[3].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[t._v(t._s(e[3].body.goodsName)+"-"+t._s(e[3].body.modelName))]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[t._v(t._s(e[3].body.marketPrice))]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[e[3].body.purchasePrice?a("el-input-number",{on:{change:function(a){return t.handlePriceChange(e[3].body)}},model:{value:e[3].body.purchasePrice,callback:function(a){t.$set(e[3].body,"purchasePrice",a)},expression:"item[3].body.purchasePrice"}}):t._e()],1):t._e()])})],2)]),t._v(" "),a("table",{staticStyle:{display:"none"},attrs:{border:"1",id:"ddd","v-loading":t.loading}},[a("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName))]),t._v(" "),a("tbody",[a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("采购商名称")]),t._v(" "),a("td",{attrs:{colspan:"4"}},[t._v(t._s(t.head.buyerName))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("负责人")]),t._v(" "),a("td",{staticClass:"print-hidden",attrs:{colspan:"2"}},[t._v(t._s(t.head.contact))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("有效期")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.startDate)+" 至 "+t._s(t.endDate)+" "),a("el-button",{attrs:{type:"text"},on:{click:t.goToNext}},[t._v("下一阶段报价")])],1)]),t._v(" "),a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("地址")]),t._v(" "),a("td",{attrs:{colspan:"7"}},[t._v(t._s(t.head.address))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("联系电话")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.head.telephone))])]),t._v(" "),t._m(1),t._v(" "),t._l(t.goodsList,function(e,s){return a("tr",{key:s},[e[0]&&e[0].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[0].name))]):t._e(),t._v(" "),e[0]&&e[0].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[0]&&e[0].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[0]&&e[0].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[t._v(t._s(e[0].body.goodsName)+"-"+t._s(e[0].body.modelName))]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[t._v(t._s(e[0].body.marketPrice))]):t._e(),t._v(" "),e[0]&&e[0].body?a("td",[t._v(t._s(e[0].body.purchasePrice)+"\n                        ")]):t._e(),t._v(" "),e[1]&&e[1].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[1].name))]):t._e(),t._v(" "),e[1]&&e[1].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[1]&&e[1].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[1]&&e[1].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[t._v(t._s(e[1].body.goodsName)+"-"+t._s(e[1].body.modelName))]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[t._v(t._s(e[1].body.marketPrice))]):t._e(),t._v(" "),e[1]&&e[1].body?a("td",[t._v(t._s(e[1].body.purchasePrice))]):t._e(),t._v(" "),e[2]&&e[2].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[2].name))]):t._e(),t._v(" "),e[2]&&e[2].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[2]&&e[2].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[2]&&e[2].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[t._v(t._s(e[2].body.goodsName)+"-"+t._s(e[2].body.modelName))]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[t._v(t._s(e[2].body.marketPrice))]):t._e(),t._v(" "),e[2]&&e[2].body?a("td",[t._v(t._s(e[2].body.purchasePrice))]):t._e(),t._v(" "),e[3]&&e[3].title?a("td",{staticClass:"blod bc-yellow",attrs:{rowspan:"2"}},[t._v(t._s(e[3].name))]):t._e(),t._v(" "),e[3]&&e[3].title?a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"2"}},[t._v("净重")]):t._e(),t._v(" "),e[3]&&e[3].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]):t._e(),t._v(" "),e[3]&&e[3].neck?a("td",{staticClass:"blod bc-yellow"},[t._v("报价")]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[t._v(t._s(e[3].body.goodsName)+"-"+t._s(e[3].body.modelName))]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[t._v(t._s(e[3].body.marketPrice))]):t._e(),t._v(" "),e[3]&&e[3].body?a("td",[t._v(t._s(e[3].body.purchasePrice))]):t._e()])})],2)])])]),t._v(" "),a("a",{attrs:{id:"bb"},on:{click:t.exportExcel}},[t._v("导出excel")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.shopDia=!0}}},[t._v("将该表格应用到\n    ")]),t._v(" "),a("el-dialog",{attrs:{title:"商家列表",visible:t.shopDia},on:{"update:visible":function(e){t.shopDia=e}}},[a("el-table",{staticStyle:{"min-width":"100%"},attrs:{data:t.buyerList,stripe:""}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"buyerName",label:"采购商","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"contact",label:"联系人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"设置上浮比率"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{step:.01},model:{value:e.row.rate,callback:function(a){t.$set(e.row,"rate",a)},expression:"scope.row.rate"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleDest(e.row,e.$index)}}},[t._v("应用到此商家")])]}}])})],1)],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{colspan:"12"}},[this._v(" ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{colspan:"12"}},[this._v(" ")])])}]};var d={data:function(){return{activeName:"first",buySeq:0,options:this.$dic.buySeqOptions,deliveryTime:(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),goodsList:[1]}},components:{},watch:{},created:function(){},methods:{handleCheck:function(){switch(this.activeName){case"first":this.fetchBuyOrderList()}},handleClick:function(){},fetchBuyOrderList:function(){}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"title"},[a("div",[t._v("商家分类:"),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.buySeq,callback:function(e){t.buySeq=e},expression:"buySeq"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("div",[t._v("\n            商家名称: "),a("div",[a("el-input",{attrs:{placeholder:"支持模糊查询"}})],1)]),t._v(" "),a("div",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleCheck}},[t._v("查询\n            ")])],1)]),t._v(" "),a("el-table",{staticStyle:{"min-width":"100%"},attrs:{data:t.goodsList,stripe:""}},[a("el-table-column",{attrs:{prop:"buyerName",label:"采购商","min-width":"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"contact",label:"联系人","min-width":"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"telephone",label:"电话","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"deliveryTime","min-width":"100",label:"报价有效期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"genPrice",label:"已报价商品数（已报价商品指与市场价不同的商品）","min-width":"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"genPrice",label:"上次购买时间","min-width":"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"应收总价","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"状态（待重新报价，报价有效期即将结束，正常）","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"totalPrice",label:"操作","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"}},[t._v("重新报价")])]}}])})],1)],1)},staticRenderFns:[]};var b={data:function(){return{activeName:"second",buySeq:0,options:this.$dic.buySeqOptions,deliveryTime:(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),goodsList:[]}},components:{vBuyerReport:a("C7Lr")(n,r,!1,function(t){a("cT0L")},"data-v-fea19f30",null).exports,vMerchantList:a("C7Lr")(d,_,!1,function(t){a("oYFy")},"data-v-1757c04c",null).exports},watch:{},created:function(){},methods:{handleCheck:function(){switch(this.activeName){case"first":this.fetchBuyOrderList()}},handleClick:function(){},fetchBuyOrderList:function(){}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"商家报价",name:"second"}},[a("v-buyer-report",{attrs:{"goods-list":t.goodsList}})],1)],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(b,v,!1,function(t){a("+oC7")},"data-v-67b75b0e",null);e.default=u.exports},cT0L:function(t,e){},oYFy:function(t,e){}});