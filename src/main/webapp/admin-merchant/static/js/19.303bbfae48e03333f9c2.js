webpackJsonp([19],{"7hGC":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});o("7tiM");var l=o("4YfN"),a=o.n(l),i=o("w4pF"),s={name:"tabs",data:function(){return{request:new i.a,allotinId:"",allotoutId:"",checkList:[],allotNum:this.$utils.strConstructor(),allotGoods:[],totalAmount:"0.00",operateNode:""}},props:{value:Array},watch:{allotinId:{handler:function(){this.checkList=[]}},allotoutId:{handler:function(){this.checkList=[]}}},created:function(){},computed:{},methods:{search:function(){this.findStockGoodsPage()},handleItemRemove:function(t,e){this.checkList.splice(e,1)},handleNumChange:function(t,e){var o=0;this.checkList.forEach(function(t){o+=t.price*t.num||0}),this.totalAmount=o.toFixed(2)},handleAddAllot:function(){this.addGoodsAllot(),this.dialogTableVisible3=!1},closeModal:function(){this.$emit("close",!1)},findStockGoodsPage:function(){var t=this;this.request.findStorageGoodsPage({warehouseId:this.allotoutId}).then(function(e){200==e.code?t.checkList=e.list:t.checkList=[]})},addGoodsAllot:function(){var t=this,e=[];this.checkList.forEach(function(t){t.num>0&&e.push({goodsModelId:t.goodsModelId,goodsName:t.goodsName,goodsNum:t.num})}),this.request.addGoodsAllot({totalAmount:this.totalAmount,allotoutId:this.allotoutId,allotinId:this.allotinId,operateNode:this.operateNode,goodsAllotDetailList:e}).then(function(e){200==e.code?t.$message.success("新增调拨成功！"):t.$message.warning(e.msg)}),this.$emit("closeModal",!1)}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticStyle:{overflow:"hidden"}},[o("div",{staticStyle:{display:"flex"}},[o("div",{staticClass:"handle-box"},[t._v("\n            调出店铺："),o("el-select",{staticClass:"input",attrs:{placeholder:"选择你要调出的店铺"},model:{value:t.allotoutId,callback:function(e){t.allotoutId=e},expression:"allotoutId"}},t._l(t.value,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("div",{staticClass:"handle-box"},[t._v("\n            调入店铺："),o("el-select",{staticClass:"input",attrs:{placeholder:"选择你要调入的店铺"},model:{value:t.allotinId,callback:function(e){t.allotinId=e},expression:"allotinId"}},t._l(t.value,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("div",{staticClass:"handle-box",staticStyle:{display:"flex"}},[o("el-button",{on:{click:t.search}},[t._v("搜索")])],1)]),t._v(" "),o("el-table",{attrs:{data:t.checkList}},[o("el-table-column",{attrs:{property:"barCode",label:"条形码"}}),t._v(" "),o("el-table-column",{attrs:{property:"goodsName",label:"商品名"}}),t._v(" "),o("el-table-column",{attrs:{property:"goodsModelId",label:"规格"}}),t._v(" "),o("el-table-column",{attrs:{property:"stockNum",label:"库存"}}),t._v(" "),o("el-table-column",{attrs:{property:"address",label:"数量",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-input-number",{attrs:{size:"mini",min:0,max:e.row.stockNum},on:{change:function(o){return t.handleNumChange(e.row,e.$index)}},model:{value:e.row.num,callback:function(o){t.$set(e.row,"num",o)},expression:"scope.row.num"}})]}}])}),t._v(" "),o("el-table-column",{attrs:{property:"price",label:"进价"}}),t._v(" "),o("el-table-column",{attrs:{property:"address",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return t.handleItemRemove(e.row,e.$index)}}},[t._v("移除")])]}}])})],1),t._v(" "),o("div",[o("div",{staticStyle:{display:"flex"}},[o("div",{staticStyle:{flex:"1",display:"flex"}},[t._v("\n                备注信息："),o("el-input",{staticStyle:{flex:"1"},attrs:{placeholder:"备注"},model:{value:t.operateNode,callback:function(e){t.operateNode=e},expression:"operateNode"}})],1),t._v(" "),o("div",{staticStyle:{flex:"1"}})]),t._v(" "),o("div",{staticStyle:{display:"flex"}},[o("div",{staticStyle:{flex:"1"}},[t._v("\n                合计金额："+t._s(t.totalAmount)+"\n            ")]),t._v(" "),o("div",{staticStyle:{flex:"1"}},[t._v("\n                调拨单号："+t._s(t.allotNum)+"\n            ")])])]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogTableVisible3=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.handleAddAllot}},[t._v("新增调拨")])],1)],1)},staticRenderFns:[]};var r={name:"goodsTransfer",components:{vWarehouse:o("C7Lr")(s,n,!1,function(t){o("cmlQ")},"data-v-fa536d8e",null).exports},data:function(){return{loading:!1,request:new i.a,elPagination:{pageNo:1,pageSize:20},orderStatus:{1:"审核中",3:"已调拨"},showHeader:!1,allotGoodList:[],checkDetailInId:"",checkDetailOutId:"",allotList:[],checkList:[],payStatusOpt:this.$dic.payStatus,orderTime:"",model:{payStatus:"",orderTime:""},supplierList:[],warehouseList:[],warehouseId:"",add:{allotoutId:"",allotinId:""},supplierId:"",ware:"",dialogTableVisible3:!1,dialogTableVisible2:!1,goodsList:[],operateNode:"",total:0,allotNum:this.$utils.strConstructor()}},created:function(){this._fetchGoodsAllotList(),this._fetchSupplierList(),this._fetchWarehouseList()},computed:{fetchGoods:function(){return{warehouseId:this.add.allotoutId}},totalAmount:function(){var t=0;return this.checkList.forEach(function(e){t+=100*e.price*e.num/100}),t}},methods:{handleSizeChange:function(t){this.elPagination.pageSize=t,this._fetchGoodsAllotList()},handleCurrentChange:function(t){this.elPagination.pageNo=t,this._fetchGoodsAllotList()},checkDetail:function(t){this.dialogTableVisible2=!0,this._queryTransferDetail(t)},search:function(){this.dialogTableVisible2=!0,this.dialogTableVisible3=!1,this._findStockGoodsPage()},handleSelectionChange:function(t){t.forEach(function(t){t.num=0}),this.checkList=t},handleItemRemove:function(t){this.checkList.splice(t,1)},handleNumChange:function(t,e){this.$set(this.checkList,e,t)},closeChoose:function(t){this.dialogTableVisible3=t},confirmAllot:function(t){var e=this;this.$confirm("您确认要商品已完成调拨？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e._confirmGoodsTransfer({id:t})})},_fetchGoodsAllotList:function(){var t=this;this.request.fetchGoodsAllotList(a()({allotoutId:this.checkDetailOutId,allotinId:this.checkDetailInId},this.elPagination)).then(function(e){(e.code=200)?(t.allotList=e.list,t.total=e.totalRows):t.allotList=[]})},_fetchSupplierList:function(){var t=this;this.request.fetchSupplierList().then(function(e){200==e.code&&(t.supplierList=e.list)})},_fetchWarehouseList:function(){var t=this;this.request.fetchWarehouseList().then(function(e){200==e.code&&(t.warehouseList=e.list)})},_queryTransferDetail:function(t){var e=this;this.request.queryTransferDetail({allotId:t}).then(function(t){200==t.code&&(e.allotGoodList=t.list)})},_findStockGoodsPage:function(){var t=this;this.request.findStorageGoodsPage(this.fetchGoods).then(function(e){200==e.code&&(t.goodsList=e.list)})},_confirmGoodsTransfer:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.request.confirmGoodsTransfer(e).then(function(e){200==e.code?(t._fetchGoodsAllotList(),t.$message.success("操作成功！")):t.$message.error(e.msg)})}}},c={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[t._v("\n            调入店铺："),o("el-select",{staticClass:"input",attrs:{placeholder:"请选择你要调入的店铺"},model:{value:t.checkDetailInId,callback:function(e){t.checkDetailInId=e},expression:"checkDetailInId"}},t._l(t.warehouseList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("div",{staticClass:"handle-box"},[t._v("\n            调出店铺："),o("el-select",{staticClass:"input",attrs:{placeholder:"请选择你要调出的店铺"},model:{value:t.checkDetailOutId,callback:function(e){t.checkDetailOutId=e},expression:"checkDetailOutId"}},t._l(t.warehouseList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("div",{staticClass:"handle-box"},[o("el-button",{attrs:{type:"primary",icon:"search"},on:{click:t._fetchGoodsAllotList}},[t._v("查询")])],1),t._v(" "),o("div",{staticClass:"handle-box"},[o("el-button",{attrs:{type:"primary",icon:"search"},on:{click:function(e){t.dialogTableVisible3=!0}}},[t._v("新增调拨")])],1)]),t._v(" "),o("div",{staticClass:"container marginTop"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.allotList,border:""}},[o("el-table-column",{attrs:{prop:"allotNum",label:"单据编号"}}),t._v(" "),o("el-table-column",{attrs:{prop:"allotinName",label:"调入门店"}}),t._v(" "),o("el-table-column",{attrs:{prop:"allotoutName",label:"调出门店"}}),t._v(" "),o("el-table-column",{attrs:{prop:"totalAmount",label:"总金额"}}),t._v(" "),o("el-table-column",{attrs:{prop:"auditStatus",label:"审核状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.orderStatus[e.row.orderStatus])+"\n                ")]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"order_info",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",icon:"search"},on:{click:function(o){return t.checkDetail(e.row.id)}}},[t._v("调拨商品列表")]),t._v(" "),o("el-button",{directives:[{name:"show",rawName:"v-show",value:e.row.orderStatus<3,expression:"scope.row.orderStatus < 3"}],attrs:{type:"text",icon:"search"},on:{click:function(o){return t.confirmAllot(e.row.id)}}},[t._v("\n                    确认调拨\n                    ")])]}}])})],1),t._v(" "),o("el-dialog",{attrs:{title:"新增调拨",width:"60%;",visible:t.dialogTableVisible3},on:{"update:visible":function(e){t.dialogTableVisible3=e}}},[o("v-warehouse",{on:{closeModal:t.closeChoose},model:{value:t.warehouseList,callback:function(e){t.warehouseList=e},expression:"warehouseList"}})],1),t._v(" "),o("el-dialog",{attrs:{title:"调拨详情",width:"60%;",visible:t.dialogTableVisible2},on:{"update:visible":function(e){t.dialogTableVisible2=e}}},[o("el-table",{attrs:{data:t.allotGoodList}},[o("el-table-column",{attrs:{property:"goodsName",label:"商品名"}}),t._v(" "),o("el-table-column",{attrs:{property:"price",label:"价格"}}),t._v(" "),o("el-table-column",{attrs:{property:"modelName",label:"规格"}}),t._v(" "),o("el-table-column",{attrs:{property:"goodsNum",label:"数量"}}),t._v(" "),o("el-table-column",{attrs:{property:"unit",label:"单位"}}),t._v(" "),o("el-table-column",{attrs:{property:"price",label:"进价"}})],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogTableVisible2=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogTableVisible2=!1}}},[t._v("确 定")])],1)],1),t._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"","current-page":t.elPagination.pageNo,"page-sizes":[20,30,40],"page-size":t.elPagination.pageSize,layout:"sizes, prev, pager, next",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){return t.$set(t.elPagination,"pageNo",e)},"update:current-page":function(e){return t.$set(t.elPagination,"pageNo",e)}}})],1)],1)])},staticRenderFns:[]};var d={name:"stockGoodsAllot",components:{vGoodsTransfer:o("C7Lr")(r,c,!1,function(t){o("ke3d")},"data-v-1842c14a",null).exports},data:function(){return{}},methods:{},computed:{}},u={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{},[e("div",{staticClass:"crumbs"},[e("el-breadcrumb",{attrs:{separator:"/"}},[e("el-breadcrumb-item",[e("i",{staticClass:"el-icon-message"}),this._v(" 库存调拨")])],1)],1),this._v(" "),e("v-goods-transfer")],1)},staticRenderFns:[]};var h=o("C7Lr")(d,u,!1,function(t){o("bwQu")},"data-v-7b0ea58e",null);e.default=h.exports},bwQu:function(t,e){},cmlQ:function(t,e){},ke3d:function(t,e){}});