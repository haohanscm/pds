webpackJsonp([24],{HkYm:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("rVsN"),a=o.n(s),l=(o("W956"),o("RHYT")),i={name:"goodsList",data:function(){return{request:new l.a,goodsCategories:[],goodsList:[],activeTab:"1",loading:!0,multipleSelection:[],isDelAll:!1,delVisible:!1,collapse:!1,totalCount:10,currentPage:1,pageSize:10,categoryId:"",searchText:"",searchSelect:"2"}},created:function(){this.getGoodsList(),this.getGoodsCategoryList()},methods:{getGoodsList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o="";"1"==this.activeTab&&(o=0),"2"==this.activeTab&&(o=2),"3"==this.activeTab&&(o=1),t.goodsStatus=o,t.categoryId=t.categoryId||this.categoryId,t.pageNo=t.pageNo||this.currentPage,t.pageSize=t.pageSize||this.pageSize,this.request.getGoodsList(t).then(function(t){e.loading=!1,"200"==t.code?(e.goodsList=t.ext.list,e.currentPage=t.ext.pageNo,e.totalCount=t.ext.count):"983"==t.code?e.goodsList=[]:e.$message.error("请求失败")})},getGoodsCategoryList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.request.fetchCategoryList(t).then(function(t){"200"==t.code?(e.goodsCategories=e.$utils.listToTree(t.ext),e.loading=!1):e.$message.error("分类数据, 请求失败")})},getCategoryGoods:function(e){var t={};t.pageNo=this.currentPage,t.categoryId=e,this.categoryId=e,this.loading=!0,this.getGoodsList(t)},searchGoodsList:function(){this.loading=!0,this.categoryId="";var e={},t=this.searchSelect;1==t&&(e.goodsSn=this.searchText),2==t&&(e.goodsName=this.searchText),e.pageNo=this.currentPage,this.getGoodsList(e)},resetGoodsList:function(){this.loading=!0,this.categoryId="",this.searchText="",this.searchSelect="1",this.currentPage=1;var e={};e.pageNo=this.currentPage;this.$refs.goodsCategoryMenu;this.getGoodsList(e)},changeTab:function(e){this.activeTab=e.name,this.loading=!0,this.categoryId="",this.getGoodsList()},collapseMenu:function(){this.collapse=!this.collapse},handleSelectionChange:function(e){this.multipleSelection=e},handleGoodsCommand:function(e){"delete"==e.type&&(this.delVisible=!0,this.delItem=e.row,this.delIndex=e.index),"deleteAll"==e.type&&(this.delVisible=!0,this.isDelAll=!0),"handleMarketable"==e.type&&this.handleMarketable(1),"handleDisMarketable"==e.type&&this.handleMarketable(0),"marketable"==e.type&&this.changeMarketable(1,e.row.goodsSn),"disMarketable"==e.type&&this.changeMarketable(0,e.row.goodsSn)},turnToAddGoods:function(){this.$router.push("/goods/addGoods")},handleDelete:function(){this.isDelAll?this.deleteAll():this.deleteRow()},deleteRow:function(){var e=this,t=[];t.push(this.delItem.goodsSn),this.request.delGoods({goodsSns:t}).then(function(t){e.delVisible=!1,200==t.code?(e.$message.success("删除成功"),e.goodsList.splice(e.delIndex,1),e.delIndex="",e.delItem=""):e.$message.error("删除失败"),e.getGoodsList()})},deleteAll:function(){var e=this,t=(this.multipleSelection.length,this.multipleSelection.map(function(e){return e.goodsSn}));this.request.delGoods({goodsSns:t}).then(function(t){200==t.code?(e.$message.success("删除成功"),e.delVisible=!1,e.$refs.goodsListTable.clearSelection(),e.isDelAll=!1,e.multipleSelection=[],e.getGoodsList()):e.$message.error("删除失败"),e.getGoodsList()})},modifyGoodsStatus:function(e,t){return this.request.modifyGoodsStatus({goodsSn:t,isMarketable:e})},changeMarketable:function(e,t){var o=this,s=e?"上架":"下架";this.modifyGoodsStatus(e,t).then(function(e){200==e.code?o.$message.success(s+"成功"):o.$message.error(s+"失败"),o.loading=!0,o.getGoodsList()})},handleMarketable:function(e){var t=this,o=e?"上架":"下架",s=[];if(this.multipleSelection.length>0)this.multipleSelection.map(function(o){var a=t.modifyGoodsStatus(e,o.goodsSn);s.push(a)});a.a.all(s).then(function(){t.$refs.goodsListTable.clearSelection(),t.multipleSelection=[],t.$message.success("批量"+o+"成功"),t.getGoodsList()},function(){t.$message.error("批量"+o+"失败")})},handleSizeChange:function(e){this.pageSize=e,this.getGoodsList()},handleCurrentChange:function(e){this.currentPage=e,this.getGoodsList()}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"table"},[o("div",{staticClass:"crumbs"},[o("el-breadcrumb",{attrs:{separator:"/"}},[o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-hh-goods"}),e._v(" 商品管理")]),e._v(" "),o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-hh-list"}),e._v(" 商品列表")])],1)],1),e._v(" "),o("div",{staticClass:"container"},[o("div",{staticClass:"search-wrap"},[o("el-input",{attrs:{placeholder:"请输入内容",width:"286"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[o("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.searchSelect,callback:function(t){e.searchSelect=t},expression:"searchSelect"}},[o("el-option",{attrs:{label:"商品编号",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"商品名称",value:"2"}})],1)],1),e._v(" "),o("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.searchGoodsList}},[e._v("搜索")]),e._v(" "),o("el-button",{attrs:{type:"default",size:"small"},on:{click:e.resetGoodsList}},[e._v("清除条件")])],1),e._v(" "),o("el-container",[o("el-header",[o("el-tabs",{on:{"tab-click":e.changeTab},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[o("el-tab-pane",{attrs:{label:"在售中",name:"1"}}),e._v(" "),o("el-tab-pane",{attrs:{label:"已售罄",name:"2"}}),e._v(" "),o("el-tab-pane",{attrs:{label:"已下架",name:"3"}})],1)],1),e._v(" "),o("el-container",[o("el-header",{staticClass:"tool-btns"},[o("div",{staticClass:"menu-title"},[e._v("商品分类"),o("i",{staticClass:"el-icon-menu",on:{click:e.collapseMenu}})]),e._v(" "),o("div",{staticClass:"btn-group"},[o("el-button",{attrs:{type:"primary"},on:{click:e.turnToAddGoods}},[e._v("新增商品")]),e._v(" "),o("el-dropdown",{on:{command:e.handleGoodsCommand}},[o("el-button",{attrs:{type:"default",size:"small"}},[e._v("\n                                更多菜单"),o("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item"),e._v(" "),"3"==e.activeTab?o("el-dropdown-item",{attrs:{command:{type:"handleMarketable"}}},[e._v("批量上架")]):e._e(),e._v(" "),"1"==e.activeTab?o("el-dropdown-item",{attrs:{command:{type:"handleDisMarketable"}}},[e._v("批量下架")]):e._e(),e._v(" "),o("el-dropdown-item",{attrs:{command:{type:"deleteAll"}}},[e._v("批量删除")])],1)],1)],1)]),e._v(" "),o("el-container",[o("el-menu",{ref:"goodsCategoryMenu",staticClass:"goods-category",attrs:{collapse:e.collapse,"unique-opened":"","default-active":""},on:{select:e.getCategoryGoods,open:e.getCategoryGoods}},[o("el-menu-item",{attrs:{index:""}},[e._v("全部")]),e._v(" "),e._l(e.goodsCategories,function(t){return[t.children?[o("el-submenu",{key:t.id,attrs:{index:t.id}},[o("template",{slot:"title"},[o("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))])]),e._v(" "),e._l(t.children,function(t,s){return o("el-menu-item",{key:s,attrs:{index:t.id}},[e._v("\n                                        "+e._s(t.name)+"\n                                    ")])})],2)]:[o("el-menu-item",{key:t.id,attrs:{index:t.id}},[o("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))])])]]})],2),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"goodsListTable",staticStyle:{width:"100%"},attrs:{data:e.goodsList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),o("el-table-column",{attrs:{prop:"sort",label:"权重",width:"80"}}),e._v(" "),o("el-table-column",{attrs:{label:"商品图片",width:"100"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("img",{staticClass:"goods-cover",attrs:{src:e.row.thumbUrl}})]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"goodsName",label:"商品名称"}}),e._v(" "),o("el-table-column",{attrs:{prop:"goodsSn",label:"商品编码",width:"120"}}),e._v(" "),o("el-table-column",{attrs:{prop:"categoryName",label:"商品分类","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{prop:"marketPrice",label:"售价","show-overflow-tooltip":"",width:"80"}}),e._v(" "),o("el-table-column",{attrs:{prop:"storage",label:"库存","show-overflow-tooltip":"",width:"60"}}),e._v(" "),o("el-table-column",{attrs:{prop:"unit",label:"单位","show-overflow-tooltip":"",width:"60"}}),e._v(" "),o("el-table-column",{attrs:{label:"是否上架","show-overflow-tooltip":"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(o){return e.changeMarketable(t.row.isMarketable,t.row.goodsSn)}},model:{value:t.row.isMarketable,callback:function(o){e.$set(t.row,"isMarketable",o)},expression:"scope.row.isMarketable"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作","show-overflow-tooltip":"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("router-link",{attrs:{to:{path:"editGoods",query:{goodsSn:t.row.goodsSn}}}},[o("el-button",{attrs:{type:"text",size:"small"}},[e._v("编辑")])],1)]}}])})],1)],1)],1)],1),e._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,40,60],"page-size":10,background:"",layout:"sizes, prev, pager, next",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"提示",visible:e.delVisible,width:"300px",center:""},on:{"update:visible":function(t){e.delVisible=t}}},[o("div",{staticClass:"del-dialog-cnt"},[e._v("删除不可恢复，是否确定删除？")]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.handleDelete}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(e){o("O4Lj"),o("MBkr")},"data-v-444e9485",null);t.default=r.exports},MBkr:function(e,t){},O4Lj:function(e,t){}});