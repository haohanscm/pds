webpackJsonp([14],{"/9ap":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("5JDp"),o=s("4YfN"),i=s.n(o),l={data:function(){return{request:new a.a,goodsIndex:"",checkList:[],modelList:[],spuGoods:{},skuGoods:{},goodsModelIndex:0,showAdd:!1}},components:{},props:{goodsList:Array,title:Object},watch:{},created:function(){},methods:{handleDetail:function(t,e){var s=this;this.$confirm("您确认要删除该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.deleteDetail(t.id,e)})},deleteDetail:function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.request.removeGoods({detailId:t}).then(function(t){200===t.code?e.goodsList.splice(s,1):e.$message.warning(t.msg)})},searchGoodsByName:function(){var t=this;return function(e){if(""!==e){var s={goodsName:e};t.getGoodsList(s).then(function(e){t.checkList=e})}}},getGoodsList:function(t){return t.shopId=$constant.shopId,t.pageSize=20,t.buyerId=this.title.buyerId,t.buySeq=this.title.buySeq,this.request.getGoodsList(t).then(function(t){if(200==t.code)return t.ext.list;console.log("商品列表获取错误",t.msg)})},openShow:function(){this.showAdd=!0},onGoodsSelectChange:function(){this.spuGoods=this.checkList[this.goodsIndex],this.skuGoods=this.spuGoods.goodsModelList[0],this.skuGoods.goodsName=this.spuGoods.goodsName},handleChangeNum:function(t){var e={};e.buyOrderDetailList=[t],this.changeNum(e)},addBuyOrder:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$confirm("您确认要新增该商品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.buyId=t.title.buyId,e.buyerId=t.title.buyerId;var s=i()({},t.skuGoods);s.goodsId=s.id,s.id="",s.goodsNum?(e.buyOrderDetailList=[s],t.request.modifyList(e).then(function(e){200==e.code?(t.$message.success(e.msg),t.skuGoods={},t.purchaseList()):(t.skuGoods={},t.$message.warning(e.msg)),t.showAdd=!1})):t.$message.warning("请输入商品数量")})},changeNum:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.buyId=this.title.buyId,e.buyerId=this.title.buyerId,this.request.modifyList(e).then(function(e){200==e.code||(t.$message.warning(e.msg),t.purchaseList())})},purchaseList:function(){var t=this;this.request.purchaseList({buyId:this.title.buyId,pageSize:100}).then(function(e){200==e.code?t.goodsList=e.ext.list:(t.goodsList=[],t.$message.warning(e.msg))}).catch(function(e){t.$message.error(e)})}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-table",{staticStyle:{"min-width":"100%"},attrs:{data:t.goodsList,stripe:"",height:"450px"}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),s("el-table-column",{attrs:{prop:"goodsName",label:"商品名称","min-width":"100"}}),t._v(" "),s("el-table-column",{attrs:{prop:"goodsModel",label:"规格"}}),t._v(" "),s("el-table-column",{attrs:{prop:"goodsNum",label:"商品数","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input-number",{on:{change:function(s){return t.handleChangeNum(e.row)}},model:{value:e.row.goodsNum,callback:function(s){t.$set(e.row,"goodsNum",s)},expression:"scope.row.goodsNum"}})]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"unit",label:"单位"}}),t._v(" "),s("el-table-column",{attrs:{prop:"marketPrice",label:"市场价"}}),t._v(" "),s("el-table-column",{attrs:{prop:"buyPrice",label:"卖价"}}),t._v(" "),s("el-table-column",{attrs:{prop:"totalPrice",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.handleDetail(e.row,e.$index)}}},[t._v("删除")])]}}])})],1),t._v(" "),s("el-row",{directives:[{name:"show",rawName:"v-show",value:t.showAdd,expression:"showAdd"}],attrs:{gutter:20}},[s("el-col",{attrs:{span:4}},[s("el-select",{staticClass:"form-field--large",attrs:{filterable:"",remote:"","remote-method":t.searchGoodsByName(),placeholder:"请输入商品名称"},on:{change:function(e){return t.onGoodsSelectChange()}},model:{value:t.goodsIndex,callback:function(e){t.goodsIndex=e},expression:"goodsIndex"}},t._l(t.checkList,function(t,e){return s("el-option",{key:t.id,attrs:{label:t.goodsName,value:e}})}),1)],1),t._v(" "),s("el-col",{attrs:{span:4}},[s("el-select",{staticClass:"form-field--large",attrs:{placeholder:"选择商品规格"},model:{value:t.goodsModelIndex,callback:function(e){t.goodsModelIndex=e},expression:"goodsModelIndex"}},t._l(t.spuGoods.goodsModelList,function(t,e){return s("el-option",{key:t.id,attrs:{label:t.modelName,value:e}})}),1)],1),t._v(" "),s("el-col",{staticStyle:{display:"flex"},attrs:{span:4}},[s("el-input",{attrs:{placeholder:"请输入数量"},model:{value:t.skuGoods.goodsNum,callback:function(e){t.$set(t.skuGoods,"goodsNum",e)},expression:"skuGoods.goodsNum"}}),t._v(" "+t._s(t.skuGoods.modelUnit)+"\n        ")],1),t._v(" "),s("el-col",{attrs:{span:4}},[t._v("\n            采购价："+t._s(t.skuGoods.purchasePrice)+"元/"+t._s(t.skuGoods.modelUnit||"单位")+"\n        ")]),t._v(" "),s("el-col",{attrs:{span:4}}),t._v(" "),s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-hh-add1"},on:{click:t.addBuyOrder}},[t._v("增加商品\n            ")])],1)],1),t._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.showAdd,expression:"!showAdd"}],attrs:{type:"primary",plain:"",icon:"el-icon-hh-add1"},on:{click:t.openShow}},[t._v("增加商品\n    ")])],1)},staticRenderFns:[]};var r=s("C7Lr")(l,n,!1,function(t){s("AfHD")},"data-v-3d527a41",null).exports,d=s("8uth"),c=s.n(d),u={data:function(){return{options:this.$dic.buySeqOptions,pmName:this.$utils.getCookie("pmName"),tabStatus:"first",shipfee:0,pageSize:20,pageNo:1,total:0,totalPage:0,totalKinds:0,list:[]}},props:{value:Object,conciseList:Array,deliveryDate:String,remarks:String},watch:{value:{handler:function(t,e){t.shipFee||(t.shipFee=0)},deep:!0,immediate:!0},conciseList:{handler:function(t,e){t.forEach(function(t){t.charge=t.goodsNum*(t.purchasePrice||t.marketPrice),t.charge=t.charge.toFixed(2)})},deep:!0,immediate:!0}},computed:{totalPrice:function(){var t=0;return this.conciseList.forEach(function(e){t+=+e.charge||0}),t.toFixed(2)},totalCharge:function(){return(+this.totalPrice+ +this.shipfee).toFixed(2)},totalNum:function(){var t=0;return this.conciseList.forEach(function(e){e.goodsNum&&(t+=+e.goodsNum)}),t}},methods:{exportExcel:function(){c.a.getExcel("ddd","","分拣单.xls","bb")},checkSupplierList:function(){this.fetchBuyOrderList()},printTable:function(t){var e=document.getElementById(t).innerHTML;window.document.body.innerHTML=e,window.print(),location.reload()}}},v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-tabs",[s("el-tab-pane",{attrs:{label:"分拣单",name:""}},[t.list?s("div",{attrs:{id:"concise"}},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("table",{attrs:{border:"1",id:"ddd"}},[s("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName)+"-分拣单")]),t._v(" "),s("tbody",[s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("采购商名称")]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"3"}},[t._v("送货批次")]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("日期")])]),t._v(" "),s("tr",[s("td",{attrs:{colspan:"2"}},[t._v(t._s(t.value.buyerName))]),t._v(" "),s("td",{attrs:{colspan:"3"}},[t._v(t._s(t.$dic.buySeqOptions[t.value.buySeq].label))]),t._v(" "),s("td",{attrs:{colspan:"2"}},[t._v(t._s(t.value.deliveryTime))])]),t._v(" "),s("tr",[s("td",{attrs:{colspan:"8"}},[t._v(" ")])]),t._v(" "),s("tr",[s("td",{staticClass:"blod"},[t._v("序号")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("采购单号")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("商品名称")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("规格")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("单位")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("供应数量")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("实际分拣量")])]),t._v(" "),t._l(t.conciseList,function(e,a){return s("tr",{key:a},[s("td",{staticClass:"blod"},[t._v(t._s(a+1))]),t._v(" "),s("td",[t._v(t._s(e.buyId))]),t._v(" "),s("td",[t._v(t._s(e.goodsName))]),t._v(" "),s("td",[t._v(t._s(e.goodsModel))]),t._v(" "),s("td",[t._v(t._s(e.unit))]),t._v(" "),s("td",[t._v(t._s(e.goodsNum))]),t._v(" "),s("td",[t._v(t._s(""))])])}),t._v(" "),s("tr",[s("td",{attrs:{colspan:"2"}},[t._v("备注")]),t._v(" "),s("td",{staticClass:"print-hidden to-left",attrs:{colspan:"6"}},[s("el-input",{model:{value:t.value.remarks,callback:function(e){t.$set(t.value,"remarks",e)},expression:"value.remarks"}})],1),t._v(" "),s("td",{staticClass:"print-show to-left",attrs:{colspan:"6"}},[t._v(t._s(t.value.remarks))])]),t._v(" "),s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"1",rowspan:"2"}},[t._v("合计")]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("商品种类")]),t._v(" "),s("td",{attrs:{colspan:"4"}},[t._v(t._s(t.conciseList.length))])]),t._v(" "),s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("采购数量")]),t._v(" "),s("td",{attrs:{colspan:"4"}},[t._v(t._s(t.totalNum))])])],2)])])]):t._e(),t._v(" "),s("a",{attrs:{id:"bb"},on:{click:t.exportExcel}},[t._v("导出excel")]),t._v(" "),s("a",{on:{click:function(e){return t.printTable("concise")}}},[t._v("打印")])]),t._v(" "),s("el-tab-pane",{attrs:{label:"采购单",name:"second"}},[t.list?s("div",{attrs:{id:"buy"}},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("table",{attrs:{border:"1",id:"buy"}},[s("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName)+"-采购单")]),t._v(" "),s("tbody",[s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("采购商名称")]),t._v(" "),s("td",{attrs:{colspan:"3"}},[t._v(t._s(t.value.buyerName))]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"1"}},[t._v("日期")]),t._v(" "),s("td",{attrs:{colspan:"2"}},[t._v(t._s(t.value.deliveryTime))])]),t._v(" "),s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"2"}},[t._v("送货地址")]),t._v(" "),s("td",{attrs:{colspan:"6"}},[t._v(t._s(t.value.address))])]),t._v(" "),s("tr",[s("td",{attrs:{colspan:"9"}},[t._v(" ")])]),t._v(" "),s("tr",[s("td",{staticClass:"blod"},[t._v("序号")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("采购单号")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("商品名称")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("规格")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("单位")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("价格")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("采购数量")]),t._v(" "),s("td",{staticClass:"blod"},[t._v("商品价格")])]),t._v(" "),t._l(t.conciseList,function(e,a){return s("tr",{key:a},[s("td",{staticClass:"blod"},[t._v(t._s(a+1))]),t._v(" "),s("td",[t._v(t._s(e.buyId))]),t._v(" "),s("td",[t._v(t._s(e.goodsName))]),t._v(" "),s("td",[t._v(t._s(e.goodsModel))]),t._v(" "),s("td",[t._v(t._s(e.unit))]),t._v(" "),s("td",[t._v(t._s(e.purchasePrice||e.marketPrice))]),t._v(" "),s("td",[t._v(t._s(e.goodsNum))]),t._v(" "),s("td",[t._v(t._s(+e.charge||""))])])}),t._v(" "),s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"2",rowspan:"2"}},[t._v("合计")]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"1"}},[t._v("商品种类")]),t._v(" "),s("td",{attrs:{colspan:"2"}},[t._v(t._s(t.conciseList.length))]),t._v(" "),s("td",{staticClass:"blod",attrs:{colspan:"1"}},[t._v("采购数量")]),t._v(" "),s("td",{attrs:{colspan:"2"}},[t._v(t._s(t.totalNum))])]),t._v(" "),s("tr",[s("td",{staticClass:"blod",attrs:{colspan:"1"}},[t._v("商品总价")]),t._v(" "),s("td",{attrs:{colspan:"5"}},[t._v(t._s(t.totalCharge)+"元")])])],2)]),t._v(" "),s("div",{staticClass:"padRight-cons"},[t._v("第一联（记账联）第二联（库房）第三联（采购商）")])]),t._v(" "),s("div",{staticClass:"footer"},[s("div",{staticClass:"right"},[s("div",{staticClass:"footer-sign"},[s("div",[t._v("签收人：")]),t._v(" "),s("div",[t._v("日期：")])])])])]):t._e(),t._v(" "),s("a",{attrs:{id:"bb"},on:{click:t.exportExcel}},[t._v("导出excel")]),t._v(" "),s("a",{on:{click:function(e){return t.printTable("buy")}}},[t._v("打印")])])],1)],1)},staticRenderFns:[]};var p={data:function(){return{dialogTableVisible:!1,dialogPrint:!1,goodsList:[],totalGoods:0,goodsPage:{pageSize:20,pageNo:1},request:new a.a,checkedItem:{},activeName:"first"}},components:{vGoodsTable:r,vPrint:s("C7Lr")(u,v,!1,function(t){s("q9Dl")},"data-v-d9237a62",null).exports},props:{orderList:Array},watch:{},created:function(){},methods:{checkDetail:function(t){this.checkedItem=t,this.purchaseList(t.buyId),this.dialogTableVisible=!0},printTable:function(t){this.checkedItem=t,this.purchaseList(t.buyId),this.dialogPrint=!0},handleDelete:function(t,e){var s=this;this.$confirm("您确认要取消"+t.buyerName+"的第"+t.buyId+"号订单吗？").then(function(e){s.modifyList({buyId:t.buyId,buyerId:t.buyerId,status:4})})},purchaseList:function(t){var e=this;this.request.purchaseList({buyId:t,pageSize:1e3}).then(function(t){200==t.code?(e.goodsList=t.ext.list,e.totalGoods=t.ext.totalRows):(e.goodsList=[],e.totalGoods=0,e.$message.warning(t.msg))}).catch(function(t){e.$message.error(t)})},modifyList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.request.modifyList(e).then(function(e){200==e.code?(t.$message.success(e.msg),t.$emit("refreshList")):t.$message.warning("取消失败："+e.msg)})}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-table",{staticStyle:{"min-width":"100%"},attrs:{data:t.orderList,stripe:""}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),s("el-table-column",{attrs:{prop:"buyId",label:"采购单编号","min-width":"100"}}),t._v(" "),s("el-table-column",{attrs:{prop:"buyerName",label:"采购商","min-width":"180"}}),t._v(" "),s("el-table-column",{attrs:{prop:"contact",label:"联系人","min-width":"80"}}),t._v(" "),s("el-table-column",{attrs:{prop:"telephone",label:"电话","min-width":"120"}}),t._v(" "),s("el-table-column",{attrs:{prop:"buyTime",label:"下单时间","min-width":"180"}}),t._v(" "),s("el-table-column",{attrs:{prop:"deliveryTime","min-width":"100",label:"配送日期"}}),t._v(" "),s("el-table-column",{attrs:{prop:"buySeq",label:"批次","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t.$dic.buySeqOptions[e.row.buySeq].label)+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"deliveryType",label:"配送方式","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t.$dic.deliveryTypeMap[e.row.deliveryType])+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"genPrice",label:"商品总价","min-width":"100"}}),t._v(" "),s("el-table-column",{attrs:{prop:"totalPrice",label:"状态","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t.$dic.buyerOption[e.row.status])+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"totalPrice",label:"操作","min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.checkDetail(e.row)}}},[t._v("详情")]),t._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.handleDelete(e.row,e.$index)}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.printTable(e.row)}}},[t._v("打印")])]}}])})],1),t._v(" "),s("el-dialog",{attrs:{title:"详情",visible:t.dialogTableVisible},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[s("v-goods-table",{attrs:{"goods-list":t.goodsList,title:t.checkedItem}})],1),t._v(" "),s("el-dialog",{attrs:{title:"分拣单打印",visible:t.dialogPrint},on:{"update:visible":function(e){t.dialogPrint=e}}},[s("v-print",{attrs:{value:t.checkedItem,"concise-list":t.goodsList}})],1)],1)},staticRenderFns:[]};var h={data:function(){return{request:new a.a,activeName:"first",buySeq:0,pageSize:20,pageNo:1,total:0,options:this.$dic.buySeqOptions,buyerId:"",buyerStatus:"",deliveryTime:(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),purchaseList:[]}},components:{vPurchaseTable:s("C7Lr")(p,_,!1,function(t){s("EALw")},"data-v-97227cfe",null).exports},watch:{},created:function(){this.handleCheck()},methods:{handleCheck:function(){switch(this.activeName){case"first":this.fetchBuyOrderList()}},handlePageChange:function(t){this.pageSize=t.pageSize,this.pageNo=t.pageNo,this.fetchBuyOrderList()},handleClick:function(){},fetchBuyOrderList:function(){var t=this;this.request.fetchBuyOrderList({deliveryDate:this.deliveryTime,buySeq:this.buySeq,status:this.buyerStatus,buyerId:this.buyerId,pageSize:this.pageSize,pageNo:this.pageNo}).then(function(e){200===e.code?(t.purchaseList=e.list,t.total=e.totalRows):(t.purchaseList=[],t.$message.warning(e.msg))})}}},b={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"title"},[s("div",[s("div",{staticClass:"block"},[s("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd","default-value":new Date,placeholder:"选择日期"},model:{value:t.deliveryTime,callback:function(e){t.deliveryTime=e},expression:"deliveryTime"}})],1)]),t._v(" "),s("div",[t._v("批次:"),s("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.buySeq,callback:function(e){t.buySeq=e},expression:"buySeq"}},t._l(t.options,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),s("div",[s("buyer-check",{model:{value:t.buyerId,callback:function(e){t.buyerId=e},expression:"buyerId"}})],1),t._v(" "),s("div",[t._v("\n            状态：\n            "),s("el-select",{staticClass:"form-field",attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:t.buyerStatus,callback:function(e){t.buyerStatus=e},expression:"buyerStatus"}},t._l(t.$dic.buyerOptionLabel,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),s("div",[s("el-button",{attrs:{type:"primary"},on:{click:t.handleCheck}},[t._v("查询\n            ")])],1)]),t._v(" "),s("v-purchase-table",{attrs:{"order-list":t.purchaseList},on:{refreshList:t.fetchBuyOrderList}}),t._v(" "),s("div",{staticClass:"page-box"},[s("div"),t._v(" "),s("my-pagination",{attrs:{"page-size":t.pageSize,"current-page":t.pageNo,total:t.total,"page-sizes":[20,30,40,50]},on:{pagechange:t.handlePageChange}})],1)],1)},staticRenderFns:[]};var m=s("C7Lr")(h,b,!1,function(t){s("zGjD")},"data-v-6af336ae",null);e.default=m.exports},AfHD:function(t,e){},EALw:function(t,e){},q9Dl:function(t,e){},zGjD:function(t,e){}});