webpackJsonp([24],{RDz6:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("jPwE"),o=a("8uth"),i=a.n(o),r=a("RHYT"),l={data:function(){return{request:new r.a,activeName:"first",buyerMerchantId:"",buyerList:[],queryDate:this.nowDate(),head:{},endDate:"",startDate:"",deliveryTime:this.nowDate(),pmName:this.$utils.getCookie("pmName"),categoryList:[],loading:!0,viewGoods:"",showDialog:!1,dialogShowType:"init",dialogForm:{shopId:"",buyerMerchantId:"",purchaseDate:[this.nowDate(),this.nowDate()],rate:0}}},components:{vBuyerMerchant:a("ui9C").a},watch:{},created:function(){this.lookUp()},computed:{},methods:{initPriceSubmit:function(){var t=this;this.showDialog=!1;var e={buyerMerchantId:this.dialogForm.buyerMerchantId,startDate:this.dialogForm.purchaseDate[0],endDate:this.dialogForm.purchaseDate[1],rate:0-this.dialogForm.rate};e.buyerMerchantId&&e.startDate&&e.endDate?e.rate<.9&&e.rate>=-10?this.request.initPrice(e).then(function(e){200===e.code?t.$message.success(e.msg):t.$message.warning(e.msg)}).catch(function(e){t.$message.warning(e)}):this.$message.warning("下调价格比例有误"):this.$message.warning("必选项未选择")},updateShopPriceSubmit:function(){var t=this;this.showDialog=!1;var e={buyerMerchantId:this.dialogForm.buyerMerchantId,startDate:this.dialogForm.purchaseDate[0],endDate:this.dialogForm.purchaseDate[1]};e.buyerMerchantId&&e.startDate&&e.endDate?this.request.updatePriceToPmShop(e).then(function(e){200===e.code?t.$message.success(e.msg):t.$message.warning(e.msg)}).catch(function(e){t.$message.warning(e)}):this.$message.warning("必选项未选择")},initPriceDialog:function(){this.dialogShowType="init",this.showDialog=!0},updateShopPriceDialog:function(){this.dialogShowType="update",this.showDialog=!0},lookUp:function(){var t=this.viewGoods;console.log("viewGoods",t),t&&document.querySelector("#tr"+t).scrollIntoView(!0)},nowDate:function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},handleCheck:function(){switch(this.activeName){case"first":this.queryList()}},handlePriceChange:function(t){this.updateGoodsPrice(t)},exportExcel:function(){if(this.categoryList){var t=this.pmName+"采购商定价单"+this.startDate+"_"+this.endDate+".xls";i.a.getExcel("exportTable","采购商定价",t,"exportBtn")}else this.$message.warning("当前无表格数据")},queryList:function(){var t=this,e={buyerMerchantId:this.buyerMerchantId,queryDate:this.queryDate};if(e.buyerMerchantId&&e.queryDate){var a=s.Loading.service({fullscreen:!0});this.request.queryGoodsList(e).then(function(e){200===e.code?(t.head=e.ext.pdsBuyer,t.categoryList=e.ext.categoryList,t.startDate=e.ext.startDate,t.endDate=e.ext.endDate,t.loading=!1):(t.$message.warning(e.msg),t.loading=!1),a.close()}).catch(function(e){t.$message.warning(e),t.loading=!1,a.close()})}else this.$message.warning("请选择采购商家和日期")},updateGoodsPrice:function(t){var e=this,a={id:t.id,price:t.purchasePrice};this.request.updateGoodsPrice(a).then(function(t){200===t.code?e.$message.success(t.msg):e.$message.warning(t.msg)}).catch(function(t){e.$message.warning(t)})}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"650px"}},[a("el-header",{staticClass:"title",staticStyle:{height:"100px"}},[a("el-form",{attrs:{inline:!0},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"采购商家:"}},[a("v-buyer-merchant",{model:{value:t.buyerMerchantId,callback:function(e){t.buyerMerchantId=e},expression:"buyerMerchantId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"查询日期:"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:t.queryDate,callback:function(e){t.queryDate=e},expression:"queryDate"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleCheck}},[t._v("查询")])],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:t.initPriceDialog}},[t._v("定价初始化")])],1),t._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary"},on:{click:t.updateShopPriceDialog}},[t._v("更新零售价")])],1),t._v(" "),a("el-col",{attrs:{span:10}},[[t._v("\n                    查找商品:\n                    "),a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:t.lookUp},model:{value:t.viewGoods,callback:function(e){t.viewGoods=e},expression:"viewGoods"}},t._l(t.categoryList,function(e){return a("el-option-group",{key:e.categoryId,attrs:{label:e.categoryName}},t._l(e.goodsList,function(t){return a("el-option",{key:t.id,attrs:{label:t.goodsName+"-"+t.modelName,value:t.id}})}),1)}),1)]],2)],1)],1),t._v(" "),a("el-main",{staticClass:"content"},[a("el-container",[a("el-main",[a("div",{staticClass:"cont-item"},[a("table",{attrs:{border:"1","v-loading":t.loading}},[a("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName))]),t._v(" "),a("tbody",[a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("采购商家名称")]),t._v(" "),a("td",{attrs:{colspan:"1"}},[t._v(t._s(t.head.merchantName))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("采购人")]),t._v(" "),a("td",{staticClass:"print-hidden",attrs:{colspan:"1"}},[t._v(t._s(t.head.contact))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("有效期")]),t._v(" "),a("td",{attrs:{colspan:"2"}},[t._v(t._s(t.startDate)+" 至 "+t._s(t.endDate)+"\n                                ")])]),t._v(" "),a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("地址")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.head.address))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("联系电话")]),t._v(" "),a("td",{attrs:{colspan:"2"}},[t._v(t._s(t.head.telephone))])]),t._v(" "),a("tr",[a("td",{attrs:{colspan:"7"}},[t._v(" ")])]),t._v(" "),t._l(t.categoryList,function(e){return[a("tr",{staticClass:"blod bc-yellow"},[a("td",{staticClass:"blod bc-yellow"},[t._v("分类名称")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("商品编号")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("商品名称")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("规格")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("采购价")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("单位")])]),t._v(" "),t._l(e.goodsList,function(e){return a("tr",{attrs:{id:"tr"+e.id}},[a("td",[t._v(t._s(e.categoryName))]),t._v(" "),a("td",[t._v(t._s(e.goodsModelSn))]),t._v(" "),a("td",[t._v(t._s(e.goodsName))]),t._v(" "),a("td",[t._v(t._s(e.modelName))]),t._v(" "),a("td",[t._v(t._s(e.marketPrice))]),t._v(" "),a("td",[a("el-input-number",{on:{change:function(a){return t.handlePriceChange(e)}},model:{value:e.purchasePrice,callback:function(a){t.$set(e,"purchasePrice",a)},expression:"goods.purchasePrice"}})],1),t._v(" "),a("td",[t._v(t._s(e.unit))])])}),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td",[t._v("-")])])]})],2)]),t._v(" "),a("table",{staticStyle:{display:"none"},attrs:{border:"1","v-loading":t.loading,id:"exportTable"}},[a("caption",{staticStyle:{"background-color":"white"}},[t._v(t._s(t.pmName))]),t._v(" "),a("tbody",[a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("采购商家名称")]),t._v(" "),a("td",{attrs:{colspan:"1"}},[t._v(t._s(t.head.merchantName))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("采购人")]),t._v(" "),a("td",{staticClass:"print-hidden",attrs:{colspan:"1"}},[t._v(t._s(t.head.contact))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("有效期")]),t._v(" "),a("td",{attrs:{colspan:"2"}},[t._v(t._s(t.startDate)+" 至 "+t._s(t.endDate)+"\n                            ")])]),t._v(" "),a("tr",[a("td",{staticClass:"blod bc-yellow",attrs:{colspan:"1"}},[t._v("地址")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t.head.address))]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("联系电话")]),t._v(" "),a("td",{attrs:{colspan:"2"}},[t._v(t._s(t.head.telephone))])]),t._v(" "),a("tr",[a("td",{attrs:{colspan:"7"}},[t._v(" ")])]),t._v(" "),t._l(t.categoryList,function(e){return[a("tr",{staticClass:"blod bc-yellow"},[a("td",{staticClass:"blod bc-yellow"},[t._v("分类名称")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("商品编号")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("商品名称")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("规格")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("市场价")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("采购价")]),t._v(" "),a("td",{staticClass:"blod bc-yellow"},[t._v("单位")])]),t._v(" "),t._l(e.goodsList,function(e){return a("tr",[a("td",[t._v(t._s(e.categoryName))]),t._v(" "),a("td",[t._v(t._s(e.goodsModelSn))]),t._v(" "),a("td",[t._v(t._s(e.goodsName))]),t._v(" "),a("td",[t._v(t._s(e.modelName))]),t._v(" "),a("td",[t._v(t._s(e.marketPrice))]),t._v(" "),a("td",[t._v("\n                                    "+t._s(e.purchasePrice)+"\n                                ")]),t._v(" "),a("td",[t._v(t._s(e.unit))])])}),t._v(" "),a("tr",[a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td")])]})],2)])])])],1)],1),t._v(" "),a("el-footer",[a("a",{attrs:{id:"exportBtn"},on:{click:t.exportExcel}},[a("el-button",{attrs:{type:"primary"}},[t._v("导出excel")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:"选项列表",visible:t.showDialog},on:{"update:visible":function(e){t.showDialog=e}}},[a("el-form",{attrs:{model:t.dialogForm},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",[a("span",{directives:[{name:"show",rawName:"v-show",value:"init"==t.dialogShowType,expression:"dialogShowType == 'init'"}]},[t._v("初始化采购商家采购价")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"update"==t.dialogShowType,expression:"dialogShowType == 'update'"}]},[t._v("更新零售店铺市场价")])]),t._v(" "),a("el-form-item",[a("v-buyer-merchant",{model:{value:t.dialogForm.buyerMerchantId,callback:function(e){t.$set(t.dialogForm,"buyerMerchantId",e)},expression:"dialogForm.buyerMerchantId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"定价时间段"}},[a("el-date-picker",{attrs:{clearable:!1,editable:!1,type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dialogForm.purchaseDate,callback:function(e){t.$set(t.dialogForm,"purchaseDate",e)},expression:"dialogForm.purchaseDate"}})],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"init"==t.dialogShowType,expression:"dialogShowType == 'init'"}],attrs:{label:"下调价格比例"}},[a("el-input",{staticStyle:{"max-width":"250px"},attrs:{placeholder:"输入小数"},model:{value:t.dialogForm.rate,callback:function(e){t.$set(t.dialogForm,"rate",e)},expression:"dialogForm.rate"}})],1),t._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"init"==t.dialogShowType,expression:"dialogShowType == 'init'"}],attrs:{type:"primary"},on:{click:t.initPriceSubmit}},[t._v("开始初始化")]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"update"==t.dialogShowType,expression:"dialogShowType == 'update'"}],attrs:{type:"primary"},on:{click:t.updateShopPriceSubmit}},[t._v("开始更新价格")])],1)],1)],1)],1)},staticRenderFns:[]};var c={data:function(){return{activeName:"second",buySeq:0,options:this.$dic.buySeqOptions,deliveryTime:(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),goodsList:[]}},components:{vBuyerReport:a("C7Lr")(l,n,!1,function(t){a("pII5")},"data-v-47c469d6",null).exports},watch:{},created:function(){},methods:{handleCheck:function(){switch(this.activeName){case"first":this.fetchBuyOrderList()}},handleClick:function(){},fetchBuyOrderList:function(){}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"商家报价",name:"second"}},[a("v-buyer-report",{attrs:{"goods-list":t.goodsList}})],1)],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(c,d,!1,function(t){a("V35c")},"data-v-8f3c7196",null);e.default=v.exports},V35c:function(t,e){},pII5:function(t,e){}});